## מסמך אפיון מערכת (PRD) – Real Estate Agent

### 1. מטרת המוצר
מערכת Real Estate Agent מאפשרת איסוף, ניתוח וניהול של מודעות נדל״ן ממקורות שונים (דגש על Yad2), תוך ממשק נוח למשתמש, שילוב עם מודלים שפתיים (LLMs) וכלי MCP, התממשקות למערכות GIS וגופים ממשלתיים, והצגת נתונים בצורה ויזואלית בממשק ווב.

### 2. יעדים עיקריים
- איסוף מידע עדכני על נכסים ממקורות שונים.
- סינון, חיפוש וניתוח מתקדם של מודעות (מחיר, מיקום, סוג נכס, מאפיינים).
- שילוב עם LLM לצורך חיפוש בשפה טבעית.
- ממשק ניהול (Broker UI) לניהול מודעות, הגדרת התראות וניתוח משכנתא.
- אפשרות ייצוא נתונים (JSON, אופציונלי CSV).
- תמיכה בהרחבות עתידיות (מערכות ממשל, GIS).

### 3. קהלי יעד (Personas)
| פרסונה | צרכים מרכזיים |
| --- | --- |
| משקיע/קונה | מציאת נכס לפי קריטריונים, ניתוח מחירים, קבלת התראות. |
| מתווך/סוכן | ניהול מודעות, תזכורות, קבלת לידים, ממשק ווב. |
| מנתח נתונים | ניתוח סטטיסטי, גישה לנתוני גולמיים, ייצוא JSON. |
| מפתח/DevOps | הרחבה קלה של המודולים, שילוב עם כלים חיצוניים, בדיקות אוטומטיות. |

### 4. תרחישי שימוש עיקריים
1. **חיפוש ידני/אוטומטי** – המשתמש מזין פרמטרים (עיר, שכונה, מחיר, וכו’) ומקבל רשימת נכסים.
2. **חיפוש בשפה טבעית** – המשתמש שולח שאילתה (לדוגמה: “דירות 4 חדרים בת״א עד 8 מיליון”), המערכת משתמשת ב-MCP+LLM ליצירת החיפוש.
3. **התראות** – משתמש מגדיר תנאים לקבלת התראות (אימייל/וואטסאפ) כאשר מופיעה מודעה חדשה העונה לקריטריונים.
4. **ניהול מודעות בממשק ווב** – מתווך/סוכן בוחן את מודעותיו, מייצא נתונים, ומנתח מגמות.

### 5. גבולות והיקף
- גרסה ראשונית ממקדת בדומיין Yad2 והרחבה למקורות נוספים בעתיד.
- ה-MCP server מותאם בראש ובראשונה ל-LM Studio/Claude, אך ניתן להרחבה.
- GUI (Broker UI) בסביבה וובית Next.js.
- Backend נוסף לדשבורד – Django (אפשרויות ניהול והרחבות API).

### 6. דרישות פונקציונליות
#### 6.1 איסוף נתונים (Scraping & Fetching)
- תמיכה בפרמטרים: עיר, שכונה, סוג נכס, מספר חדרים, טווח מחיר, רמת גימור, חניה, מעלית, ועוד.
- אימות פרמטרים (validation) ויצירת URL תקין ל-Yad2.
- Rate limiting, רוטציה של user-agent, ועמידה ב-robots.txt.
- אפשרות לגישת GIS (לדוגמה: Tel Aviv ArcGIS) לצורך מידע מרחבי משלים.

#### 6.2 מודל הנתונים
- `RealEstateListing`: שדות כמו זיהוי, כותרת, מחיר, כתובת, מאפיינים, תמונות, מקור.
- שמירת תאריך איסוף, URL מקורי, סטטוס העדכון.
- נתוני מטה על החיפוש: פרמטרים, תיאור, תוצאות.

#### 6.3 שכבת לוגיקה וממשק CLI/MCP
- CLI אינטראקטיבי: ניווט לפי תפריטים, הגדרת פרמטרים, ביצוע חיפוש, תצוגת תוצאות.
- MCP server (FastAPI/FastMCP): כלים כמו `search_properties`, `get_search_parameters_reference`, `analyze_search_results`, `save_search_results`, `build_search_url`.
- הדגמת שימוש (yad2/examples/demo.py).

#### 6.4 ממשק ניהול – Broker Dashboard UI
- מבוסס Next.js.
- יכולות:
  - צפייה והסרת רשימות.
  - הגדרת התראות.
  - ניתוח משכנתא בסיסי.
  - תצוגה ויזואלית של גרפים (מחירי ממוצע, התפלגות).

#### 6.5 התממשקות למערכות ממשלתיות
- מודול gov/mcp: גישה ל-API של gov.il (לדוגמה – רישומי נכסים, מידע מסים).
- שימוש במסגרת MCP ככלי עזר לשאילתה מתוך LLM.

#### 6.6 ניתוח וייצוא
- `analyze_search_results`: קביעת ממוצעי מחיר, התפלגות לפי אזור/סוג נכס, גרפים.
- ייצוא: יצירת קובץ JSON הכולל metadata מלאה.

### 7. דרישות לא פונקציונליות
| תחום | דרישה |
| --- | --- |
| ביצועים | זמן תגובה סביר (עד 5 שניות/שאילתה), טיפול בעד 1,000 מודעות לשאילתה. |
| אבטחה | ניהול סודות (API keys), מניעת שימוש לא חוקי, הגבלת גישה. |
| סקלביליות | יכולת הרחבה למקורות נתונים/מודולים חדשים ללא שינוי ארכיטקטוני משמעותי. |
| אמינות | לוגים ויכולות retry בחיבור לאתרים. |
| תחזוקה | קוד מודולרי, בדיקות (pytest), תיעוד. |
| נגישות | ממשק CLI ברור, ווב: תאימות נייד/נייח. |

### 8. ארכיטקטורה ותרשים כללי
```
משתמש CLI / LLM ----> MCP Server ----> מודול yad2 (scraper + core)
                      |                 |
                      |                 +--> Utils (תצוגת URL, פיענוח)
                      |
                      +--> מודולי GIS ו-gov למידע משלים
                      
משתמש ווב (Broker UI) ----> Django Backend ----> DB (לדוגמה: PostgreSQL)
                            |
                            +--> שילוב עם מודול הגרפים/ניתוח
```

### 9. מודולים עיקריים (תקציר)
- **yad2/core** – פרמטרים, מודלים, Utilities.
- **yad2/scrapers** – scrapers ל-Yad2.
- **yad2/mcp** – MCP Server (FastMCP) לשילוב LLM.
- **yad2/cli** – CLI אינטראקטיבי.
- **gis/** – לקוח ArcGIS של תל אביב.
- **gov/** – MCP לגופים ממשלתיים.
- **realestate-broker-ui/** – ה-UI (Next.js).
- **backend-django/** – שרת Backend לניהול, אחסון, API.

### 10. API עיקריים (דוגמה)
| כלי MCP | תיאור |
| --- | --- |
| `search_properties` | ביצוע חיפוש (פרמטרים: topArea, city, neighborhood, priceRange וכו’). |
| `get_search_parameters_reference` | החזרת רשימת פרמטרים אפשריים ותיאורם. |
| `analyze_search_results` | החזרת סטטיסטיקות על תוצאות החיפוש. |
| `save_search_results` | ייצוא תוצאות לקובץ JSON. |
| `build_search_url` | בניית כתובת URL ל-Yad2 ללא ביצוע scraping. |

### 11. אבני דרך ראשוניות
1. **MVP Scraper + CLI** – חיפוש בסיסי, ייצוא JSON.
2. **שילוב MCP Server** – חיפוש בשפה טבעית, תיעוד פרמטרים.
3. **Broker UI v1** – דשבורד לניהול והתראות.
4. **ניתוח מתקדם + GIS/GOV** – חיבור למידע גאוגרפי וממשלתי.
5. **הקשחת אבטחה ושיפורי סקייל** – לוגינג, אופטימיזציה, בדיקות.

### 12. סיכונים ואתגרים
- שינוי HTML באתרי המקור (Yad2) → צורך בעדכונים תכופים.
- מגבלות שימוש ב-API ממשלתיים (הגבלת תדירות, הרשאות).
- טעינת LLM (השגת תוצאות מדויקות) – תלוי במודל ובקונטקסט.
- אבטחת מידע בעת איסוף ושימור נתונים רגישים.

### 13. מדדי הצלחה
- מספר מודעות שנאספות ביום/בשבוע.
- זמן תגובה ממוצע לחיפוש.
- מספר משתמשים פעילים בממשק ווב.
- שיפור בשיעור הקליקים/התעניינות בהתראות.
- שביעות רצון משתמשים (משוב, אנליטיקה).

---

מסמך זה מספק אפיון מלא למערכת Real Estate Agent ויכול לשמש כבסיס לשמירה בקובץ PRD לצורך המשך פיתוח וניהול המוצר.

