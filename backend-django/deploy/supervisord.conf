[supervisord]
nodaemon=true
; don't rotate a real file—send supervisord’s own logs nowhere
logfile=/dev/null
logfile_maxbytes=0
pidfile=/tmp/supervisord.pid
childlogdir=/tmp

[program:gunicorn]
directory=/app
command=gunicorn broker_backend.wsgi:application --bind 0.0.0.0:8000 --workers 1 --timeout 120
autostart=true
autorestart=true
stopsignal=TERM
; write process logs to the container FDs and DISABLE rotation
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0
environment=PYTHONUNBUFFERED="1"

[program:celery]
directory=/app
command=celery -A broker_backend worker -l info -c 2
autostart=true
autorestart=true
stopsignal=TERM
stdout_logfile=/dev/fd/1
stdout_logfile_maxbytes=0
stderr_logfile=/dev/fd/2
stderr_logfile_maxbytes=0
environment=PYTHONUNBUFFERED="1"
